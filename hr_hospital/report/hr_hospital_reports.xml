<odoo>
    <record id="hr_hospital_disease_report_wizard" model="ir.actions.report">
        <field name="name">Diseases report</field>
        <field name="model">hr.hospital.disease.report.wizard</field>
        <field name="report_type">qweb-html</field>
        <field name="report_name">hr_hospital.report_disease_template</field>
        <field name="report_file">hr_hospital.report_disease_template</field>
        <field name="print_report_name">(object._get_report_base_filename())
        </field>
        <!--        <field name="binding_model_id" ref="model_hr_hospital_disease"/>-->
        <!--        <field name="binding_type">report</field>-->
    </record>

    <template id="report_disease_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">
                    <h2>Disease Report</h2>

                    <p><t t-out="docs"/></p>

                    <!-- Safe display of filter information -->
                    <div class="filter-info mb-4"
                         t-if="data and data.get('form_data')">
                        <p>
                            <strong>Period:</strong>
                            <span t-esc="docs['form_data'].get('date_from', 'N/A')"/>
                            to
                            <span t-esc="data['form_data'].get('date_to', 'N/A')"/>
                        </p>
                        <p>
                            <strong>Doctor:</strong>
                            <span t-esc="data['form_data'].get('doctor_names', 'N/A')"/>
                        </p>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; margin: 15px 0; border: 1px dashed #ccc;">
                        <h4>Debug Data:</h4>
                        <pre t-esc="str(data)"/>
                    </div>
                    <!-- Main report table with null checks -->
                    <table class="table table-bordered"
                           t-if="data and data.get('diagnoses')">
                        <thead>
                            <tr>
                                <th>Disease</th>
                                <th>Patient</th>
                                <th>Doctor</th>
                                <th>Visit Date</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="data.get('diagnoses', [])"
                                t-as="diagnosis">
                                <td>
                                    <span t-esc="diagnosis.get('disease_name', '')"/>
                                </td>
                                <td>
                                    <span t-esc="diagnosis.get('patient_name', '')"/>
                                </td>
                                <td>
                                    <span t-esc="diagnosis.get('doctor_name', '')"/>
                                </td>
                                <td>
                                    <span t-esc="diagnosis.get('visit_date', '')"/>
                                </td>
                                <td>
                                    <span t-esc="diagnosis.get('description', '')"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Show message if no data -->
                    <div t-if="not data or not data.get('diagnoses')"
                         class="alert alert-info">
                        No diagnosis records found for the selected criteria!
                    </div>
                </div>
            </t>
        </t>
    </template>
</odoo>
